// Copyright (c) 2019 Seung-hyun Hwang
var imageProcessor={};!function(e,i){e.URL=e.URL||e.webkitURL,i.body=i.body||i.getElementsByTagName("body")[0]||i.createElement("body"),imageProcessor.preload=function(e){var t;return Array.isArray(e)||(e=[e]),1==(t=e.map(function(r){return new Promise(function(e,t){var o=new Image;o.onload=function(){e(o)},o.onerror=t,o.src=r})})).length?t[0]:Promise.all(t)},imageProcessor.imageToFile=function(r,n){return n=n||"f.png",new Promise(function(t,e){var o=i.createElement("canvas");if(!o.toBlob)throw new Error("HTMLCanvasElement.toBlob method does not support.");o.width=r.width,o.height=r.height,o.getContext("2d").drawImage(r,0,0),o.toBlob(function(e){t(new File([e],n))})})},imageProcessor.fileToImage=function(e){return imageProcessor.preload(URL.createObjectURL(e))},imageProcessor.compressImage=function(a,s){var m,c=i.createElement("canvas"),l=c.getContext("2d");return c.width=a.width,c.height=a.height,l.drawImage(a,0,0),new Promise(function(n,i){if(!c.toBlob)return i(new Error("HTMLCanvasElement.toBlob method does not support."));c.toBlob(function(e){var t,o,r=new File([e],"i.png");if((m=r.size)<=s)return n(a);c.width=t=Math.floor(c.width*Math.sqrt(s/m)),c.height=o=Math.floor(c.height*Math.sqrt(s/m)),l.drawImage(a,0,0,t,o),c.toBlob(function(e){imageProcessor.fileToImage(new File([e],"i.png")).then(n).catch(i)})})})},imageProcessor.requestImage=function(e){var o=i.createElement("input"),t=i.getElementById("image-processor-hidden-element");return t||((t=i.createElement("div")).id="image-processor-hidden-element",t.style.display="none",i.body.appendChild(t)),t.appendChild(o),o.setAttribute("type","file"),o.setAttribute("accept",".jpg, .jpeg, .png, .gif, image/*"),e&&o.setAttribute("multiple",1),new Promise(function(t){o.onchange=function(){var e=Array.from(o.files).map(function(e){return imageProcessor.fileToImage(e)});(1==e.length?e[0]:Promise.all(e)).then(t)},o.click()})}}(this,document);
